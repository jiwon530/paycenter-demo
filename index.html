<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>페이센터 - 통합 혜택 관리 플랫폼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        .tab-active {
            border-bottom-color: #f59e0b;
            color: #d97706;
        }
        .phase-indicator {
            animation: pulse 2s infinite;
        }
        .logic-block {
            transition: all 0.2s ease;
        }
        .logic-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .selected-logic {
            background: #fef3c7;
            border-color: #f59e0b !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* 차트 컨테이너 크기 고정 */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100">
    <!-- 헤더 -->
    <header class="bg-white shadow-sm border-b">
        <div class="px-6 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold text-gray-900">페이센터</h1>
                <span class="text-sm text-gray-500">통합 혜택 관리 플랫폼</span>
            </div>
            
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <input type="text" placeholder="혜택 검색..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-64">
                </div>
                <svg class="w-5 h-5 text-gray-600 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5V3"></path>
                </svg>
                <svg class="w-5 h-5 text-gray-600 cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </div>
        </div>
        
        <!-- 탭 네비게이션 -->
        <div class="px-6">
            <nav class="flex space-x-8">
                <button class="tab-button py-3 px-1 border-b-2 font-medium text-sm tab-active" data-tab="dashboard">대시보드</button>
                <button class="tab-button py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700" data-tab="benefits">혜택 관리</button>
                <button class="tab-button py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700" data-tab="create">혜택 만들기</button>
                <button class="tab-button py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700" data-tab="analytics">분석</button>
                <button class="tab-button py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700" data-tab="settlement">정산</button>
            </nav>
        </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="px-6 py-6">
        <!-- 대시보드 탭 -->
        <div id="dashboard-content" class="tab-content active">
            <!-- 요약 카드 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-600">활성 혜택</p>
                            <p class="text-2xl font-bold text-gray-900">12</p>
                        </div>
                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-600">월 예산 소진율</p>
                            <p class="text-2xl font-bold text-gray-900">73%</p>
                        </div>
                        <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-600">평균 전환율</p>
                            <p class="text-2xl font-bold text-gray-900">9.2%</p>
                        </div>
                        <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 101.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-600">이번달 절약</p>
                            <p class="text-2xl font-bold text-gray-900">4.2억</p>
                        </div>
                        <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 차트 섹션 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">월별 혜택 성과</h3>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">서비스별 혜택 사용 분포</h3>
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 혜택 관리 탭 -->
        <div id="benefits-content" class="tab-content">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <div class="flex items-center space-x-4">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                    <select class="border border-gray-300 rounded-lg px-3 py-2">
                        <option>전체 상태</option>
                        <option>진행중</option>
                        <option>일시정지</option>
                        <option>예약됨</option>
                    </select>
                    <select class="border border-gray-300 rounded-lg px-3 py-2">
                        <option>전체 서비스</option>
                        <option>결제</option>
                        <option>카드</option>
                        <option>증권</option>
                    </select>
                </div>
                
                <button class="create-benefit-btn flex items-center space-x-2 bg-amber-500 text-white px-4 py-2 rounded-lg hover:bg-amber-600 transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    <span>새 혜택</span>
                </button>
            </div>

            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">혜택명</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">상태</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">예산 사용률</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">전환율</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">액션</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="benefits-table-body">
                            <!-- JavaScript로 동적 생성 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 혜택 만들기 탭 -->
        <div id="create-content" class="tab-content">
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg p-6 border border-yellow-200 mb-6">
                <h3 class="text-xl font-bold mb-2 text-gray-800">혜택 로직 라이브러리 - "확장 가능한 레고블록" 방식</h3>
                <p class="text-gray-700 mb-4">미리 구현된 혜택 로직을 조합하여 복잡한 혜택도 간단하게 생성 (지속적 확장 지원)</p>
                <div class="flex flex-wrap items-center text-sm gap-4">
                    <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full">기존: 4주 개발</span>
                    <span>→</span>
                    <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full">페이센터: 5분 완성</span>
                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full">Phase 2 로직 활용</span>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 bg-white rounded-lg shadow-lg p-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-4">
                        <h4 class="text-lg font-bold">1단계: 기본 혜택 로직 선택</h4>
                        <div class="flex items-center space-x-2">
                            <div class="flex items-center text-xs">
                                <div class="w-3 h-3 bg-blue-500 rounded-full mr-1"></div>
                                <span>Phase 1</span>
                            </div>
                            <div class="flex items-center text-xs">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-1"></div>
                                <span>Phase 2</span>
                            </div>
                            <button id="extension-toggle" class="text-xs bg-amber-100 hover:bg-amber-200 text-amber-800 px-2 py-1 rounded transition-colors">
                                확장 관리
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="logic-blocks-container">
                        <!-- JavaScript로 동적 생성 -->
                    </div>

                    <div id="extension-panel" class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg" style="display: none;">
                        <h5 class="font-bold text-yellow-800 mb-3">로직 확장 관리</h5>
                        <div class="space-y-2 text-sm">
                            <div class="flex items-center justify-between p-2 bg-white rounded">
                                <span>등급별 할인 로직</span>
                                <span class="text-green-600">Phase 2에서 추가됨</span>
                            </div>
                            <div class="flex items-center justify-between p-2 bg-gray-100 rounded">
                                <span>AI 개인화 추천 로직</span>
                                <span class="text-gray-500">Phase 3 개발 예정</span>
                            </div>
                            <button class="w-full mt-2 py-2 bg-amber-500 text-white rounded hover:bg-amber-600 font-medium transition-colors">
                                새 로직 요청하기
                            </button>
                        </div>
                    </div>

                    <div id="conditions-section" class="mt-6 pt-6 border-t border-gray-200" style="display: none;">
                        <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-4">
                            <h4 class="text-lg font-bold">2단계: 적용 조건 설정 (고급 조건 빌더)</h4>
                            <button class="text-sm text-amber-600 hover:text-amber-800 font-medium">
                                고급 조건 빌더 열기
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="condition-blocks-container">
                            <!-- JavaScript로 동적 생성 -->
                        </div>

                        <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                            <h5 class="font-semibold text-yellow-800 mb-2">복합 조건 예시</h5>
                            <p class="text-sm text-yellow-700">
                                "월 3회 이상 + 금요일 + VIP 고객 + 카테고리 제외" 같은 복잡한 조건도 
                                고급 조건 빌더에서 설정 가능 (AND/OR 로직 지원)
                            </p>
                        </div>
                    </div>

                    <div id="api-preview-section" class="mt-6 pt-6 border-t border-gray-200" style="display: none;">
                        <h4 class="text-lg font-bold mb-4">3단계: API 호출 미리보기</h4>
                        <div class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm">
                            <div class="mb-2">
                                <span class="text-blue-400">POST</span>
                                <span class="text-white ml-2">/benefits/create</span>
                            </div>
                            <div class="text-white" id="api-preview-content">
                                로직을 선택해주세요
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-bold mb-4">혜택 미리보기</h4>
                        <div class="bg-gray-50 rounded-lg p-4 min-h-[100px] flex items-center justify-center mb-4" id="benefit-preview">
                            <div class="text-gray-400 text-center">
                                혜택 로직을 선택해주세요
                            </div>
                        </div>
                        
                        <button id="create-benefit-final" disabled class="w-full py-3 px-4 rounded-lg font-semibold transition-all bg-gray-300 text-gray-500 cursor-not-allowed">
                            혜택 생성 (API 호출)
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-bold mb-4">확장 로드맵</h4>
                        <div class="space-y-3 text-sm">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                <span class="font-medium">Phase 1 (현재)</span>
                            </div>
                            <p class="text-gray-600 ml-5 text-xs">기본 6가지 로직으로 80% 케이스 커버</p>
                            
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                <span class="font-medium">Phase 2 (추가됨)</span>
                            </div>
                            <p class="text-gray-600 ml-5 text-xs">사용 패턴 분석 후 자주 요청되는 로직 추가</p>
                            
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-gray-400 rounded-full mr-2"></div>
                                <span class="font-medium">Phase 3 (개발중)</span>
                            </div>
                            <p class="text-gray-600 ml-5 text-xs">AI 기반 개인화 및 로직 빌더 도구</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h4 class="text-lg font-bold mb-4">고급 조합 예시</h4>
                        <div class="space-y-3 text-sm">
                            <div class="p-3 bg-blue-50 rounded-lg">
                                <strong>기본 조합 (P1):</strong><br/>
                                편의점 + 3만원 이상 + 10% 할인
                            </div>
                            <div class="p-3 bg-green-50 rounded-lg">
                                <strong>고급 조합 (P2):</strong><br/>
                                월3회이상 + 금요일 + 등급별할인 + 카테고리제외
                            </div>
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <strong>미래 조합 (P3):</strong><br/>
                                AI추천 + 개인화조건 + 동적할인율
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 분석 탭 -->
        <div id="analytics-content" class="tab-content">
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-xl font-bold mb-6">심화 분석</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-lg font-semibold mb-4">A/B 테스트 결과</h4>
                        <div class="space-y-4">
                            <div class="border border-gray-200 rounded-lg p-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-medium">10% vs 15% 할인</span>
                                    <span class="text-green-600 font-bold">15% 승리</span>
                                </div>
                                <div class="text-sm text-gray-600">
                                    전환율 차이: +2.3%p | 통계적 유의성: 95%
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-4">ROI 분석</h4>
                        <div class="chart-container">
                            <canvas id="roiChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 정산 탭 -->
        <div id="settlement-content" class="tab-content">
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-xl font-bold mb-6">정산 관리</h3>
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">이번달 총 지출</h4>
                            <p class="text-2xl font-bold text-gray-900">12.8억원</p>
                            <p class="text-sm text-gray-500">전월 대비 +8.2%</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">예상 절약액</h4>
                            <p class="text-2xl font-bold text-green-600">4.2억원</p>
                            <p class="text-sm text-gray-500">통합 플랫폼 효과</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">정산 대기</h4>
                            <p class="text-2xl font-bold text-orange-600">23건</p>
                            <p class="text-sm text-gray-500">자동 처리 예정</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-semibold mb-4">서비스별 정산 현황</h4>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">서비스</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">이번달 지출</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">예산 대비</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">상태</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200" id="settlement-table-body">
                                    <!-- JavaScript로 동적 생성 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // 전역 변수
        let selectedLogic = null;
        let selectedConditions = [];

        // 샘플 데이터
        const benefitData = [
            { name: '신규가입 10% 할인', status: 'active', budget: 50000000, used: 32000000, conversion: 8.5, type: '정률할인' },
            { name: '첫결제 캐시백', status: 'active', budget: 30000000, used: 28500000, conversion: 12.3, type: '캐시백' },
            { name: 'VIP 무료송금', status: 'paused', budget: 20000000, used: 15000000, conversion: 6.7, type: '수수료면제' },
            { name: '여름 특가 쿠폰', status: 'scheduled', budget: 40000000, used: 0, conversion: 0, type: '정액할인' }
        ];

        const logicBlocks = [
            { id: 'discount_percent', name: '정률 할인', desc: '10% 할인', phase: 1 },
            { id: 'discount_fixed', name: '정액 할인', desc: '2000원 할인', phase: 1 },
            { id: 'cashback', name: '캐시백', desc: '3% 적립', phase: 1 },
            { id: 'points', name: '포인트', desc: '포인트 적립/차감', phase: 1 },
            { id: 'coupon', name: '쿠폰 발급', desc: '할인쿠폰 자동 발급', phase: 1 },
            { id: 'fee_waiver', name: '수수료 면제', desc: '송금 수수료 면제', phase: 1 },
            { id: 'tier_discount', name: '등급별 할인', desc: '구매횟수별 차등 할인', phase: 2 },
            { id: 'bundle_discount', name: '묶음 할인', desc: '복합 서비스 이용 할인', phase: 2 }
        ];

        const conditionBlocks = [
            { id: 'amount', name: '최소 금액', desc: '30,000원 이상', phase: 1 },
            { id: 'location', name: '사용 장소', desc: '편의점', phase: 1 },
            { id: 'time', name: '시간 조건', desc: '오후 2-4시', phase: 1 },
            { id: 'user_type', name: '사용자 조건', desc: '신규 가입자', phase: 1 },
            { id: 'frequency', name: '사용 횟수', desc: '월 3회 이상', phase: 2 },
            { id: 'day_of_week', name: '요일 조건', desc: '금요일만', phase: 2 },
            { id: 'category_exclude', name: '카테고리 제외', desc: '담배/주류 제외', phase: 2 }
        ];

        const settlementData = [
            { service: '결제', spent: '4.2억', ratio: '84%', status: 'normal' },
            { service: '카드', spent: '3.1억', ratio: '92%', status: 'warning' },
            { service: '증권', spent: '2.8억', ratio: '70%', status: 'normal' },
            { service: '멤버십', spent: '2.7억', ratio: '108%', status: 'over' }
        ];

        // 유틸리티 함수
        function getStatusBadge(status) {
            const statusConfig = {
                active: { text: '진행중', color: 'bg-green-100 text-green-800' },
                paused: { text: '일시정지', color: 'bg-yellow-100 text-yellow-800' },
                scheduled: { text: '예약됨', color: 'bg-blue-100 text-blue-800' },
                ended: { text: '종료', color: 'bg-gray-100 text-gray-800' }
            };
            const config = statusConfig[status];
            return '<span class="px-2 py-1 rounded-full text-xs font-medium ' + config.color + '">' + config.text + '</span>';
        }

        // 탭 관리
        function switchTab(tabName) {
            // 모든 탭 내용 숨기기
            document.querySelectorAll('.tab-content').forEach(function(content) {
                content.classList.remove('active');
            });
            
            // 모든 탭 버튼 비활성화
            document.querySelectorAll('.tab-button').forEach(function(button) {
                button.classList.remove('tab-active');
                button.classList.add('border-transparent', 'text-gray-500');
            });
            
            // 선택된 탭 활성화
            document.getElementById(tabName + '-content').classList.add('active');
            const activeButton = document.querySelector('[data-tab="' + tabName + '"]');
            activeButton.classList.add('tab-active');
            activeButton.classList.remove('border-transparent', 'text-gray-500');
            
            // 탭별 초기화
            if (tabName === 'dashboard') {
                // 대시보드 탭이 표시된 후에 차트 초기화
                setTimeout(initCharts, 100);
            } else if (tabName === 'benefits') {
                renderBenefitsTable();
            } else if (tabName === 'create') {
                renderLogicBlocks();
            } else if (tabName === 'settlement') {
                renderSettlementTable();
            } else if (tabName === 'analytics') {
                setTimeout(initROIChart, 100);
            }
        }

        // 혜택 테이블 렌더링
        function renderBenefitsTable() {
            const tbody = document.getElementById('benefits-table-body');
            tbody.innerHTML = benefitData.map(function(benefit) {
                const usagePercent = Math.round((benefit.used / benefit.budget) * 100);
                return '<tr class="hover:bg-gray-50">' +
                    '<td class="px-6 py-4 whitespace-nowrap">' +
                        '<div>' +
                            '<div class="text-sm font-medium text-gray-900">' + benefit.name + '</div>' +
                            '<div class="text-sm text-gray-500">' + benefit.type + '</div>' +
                        '</div>' +
                    '</td>' +
                    '<td class="px-6 py-4 whitespace-nowrap">' +
                        getStatusBadge(benefit.status) +
                    '</td>' +
                    '<td class="px-6 py-4 whitespace-nowrap">' +
                        '<div class="flex items-center">' +
                            '<div class="flex-1">' +
                                '<div class="w-full bg-gray-200 rounded-full h-2">' +
                                    '<div class="bg-amber-600 h-2 rounded-full" style="width: ' + usagePercent + '%"></div>' +
                                '</div>' +
                            '</div>' +
                            '<span class="ml-2 text-sm text-gray-500">' + usagePercent + '%</span>' +
                        '</div>' +
                    '</td>' +
                    '<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">' + benefit.conversion + '%</td>' +
                    '<td class="px-6 py-4 whitespace-nowrap text-sm font-medium">' +
                        '<div class="flex space-x-2">' +
                            '<button class="text-amber-600 hover:text-amber-900">' +
                                '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>' +
                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>' +
                                '</svg>' +
                            '</button>' +
                            '<button class="text-gray-600 hover:text-gray-900">' +
                                '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>' +
                                '</svg>' +
                            '</button>' +
                            '<button class="text-yellow-600 hover:text-yellow-900">' +
                                '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>' +
                                '</svg>' +
                            '</button>' +
                        '</div>' +
                    '</td>' +
                '</tr>';
            }).join('');
        }

        // 정산 테이블 렌더링
        function renderSettlementTable() {
            const tbody = document.getElementById('settlement-table-body');
            tbody.innerHTML = settlementData.map(function(row) {
                let statusClass = 'bg-green-100 text-green-800';
                let statusText = '정상';
                if (row.status === 'warning') {
                    statusClass = 'bg-yellow-100 text-yellow-800';
                    statusText = '주의';
                } else if (row.status === 'over') {
                    statusClass = 'bg-red-100 text-red-800';
                    statusText = '초과';
                }
                
                return '<tr>' +
                    '<td class="px-6 py-4 whitespace-nowrap font-medium">' + row.service + '</td>' +
                    '<td class="px-6 py-4 whitespace-nowrap">' + row.spent + '</td>' +
                    '<td class="px-6 py-4 whitespace-nowrap">' + row.ratio + '</td>' +
                    '<td class="px-6 py-4 whitespace-nowrap">' +
                        '<span class="px-2 py-1 rounded-full text-xs ' + statusClass + '">' + statusText + '</span>' +
                    '</td>' +
                '</tr>';
            }).join('');
        }

        // 로직 블록 렌더링
        function renderLogicBlocks() {
            const container = document.getElementById('logic-blocks-container');
            container.innerHTML = logicBlocks.map(function(block) {
                const phaseClass = block.phase === 1 ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700';
                const phaseIndicator = block.phase === 2 ? '<div class="absolute top-2 left-2 w-2 h-2 bg-green-500 rounded-full phase-indicator"></div>' : '';
                
                return '<div class="logic-block p-4 rounded-lg border-2 cursor-pointer border-gray-200 hover:border-gray-300 relative" data-logic-id="' + block.id + '">' +
                    '<div class="flex items-start justify-between">' +
                        '<div class="flex-1">' +
                            '<h5 class="font-bold mb-1">' + block.name + '</h5>' +
                            '<p class="text-sm text-gray-600">' + block.desc + '</p>' +
                        '</div>' +
                        '<span class="text-xs px-2 py-1 rounded-full ' + phaseClass + '">P' + block.phase + '</span>' +
                    '</div>' +
                    phaseIndicator +
                '</div>';
            }).join('');

            // 로직 블록 클릭 이벤트
            document.querySelectorAll('.logic-block').forEach(function(block) {
                block.addEventListener('click', function() {
                    const logicId = this.getAttribute('data-logic-id');
                    selectedLogic = logicBlocks.find(function(l) { return l.id === logicId; });
                    
                    // 선택된 블록 스타일 업데이트
                    document.querySelectorAll('.logic-block').forEach(function(b) {
                        b.classList.remove('selected-logic');
                        b.classList.add('border-gray-200');
                    });
                    this.classList.add('selected-logic');
                    this.classList.remove('border-gray-200');
                    
                    // 조건 섹션 표시
                    document.getElementById('conditions-section').style.display = 'block';
                    renderConditionBlocks();
                    
                    // API 미리보기 섹션 표시
                    document.getElementById('api-preview-section').style.display = 'block';
                    updateAPIPreview();
                    
                    // 혜택 미리보기 업데이트
                    updateBenefitPreview();
                    
                    // 생성 버튼 활성화
                    const createBtn = document.getElementById('create-benefit-final');
                    createBtn.disabled = false;
                    createBtn.className = 'w-full py-3 px-4 rounded-lg font-semibold transition-all bg-amber-500 text-white hover:bg-amber-600';
                });
            });
        }

        // 조건 블록 렌더링
        function renderConditionBlocks() {
            const container = document.getElementById('condition-blocks-container');
            const currentPhase = 2;
            
            container.innerHTML = conditionBlocks.map(function(condition) {
                const disabled = condition.phase > currentPhase;
                const phaseClass = condition.phase === 1 ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700';
                const phaseIndicator = condition.phase === 2 ? '<div class="absolute top-2 right-8 w-2 h-2 bg-green-500 rounded-full phase-indicator"></div>' : '';
                const labelClass = disabled ? 'opacity-50 cursor-not-allowed' : 'border-gray-200';
                
                return '<label class="flex items-center p-3 border rounded-lg hover:bg-gray-50 relative ' + labelClass + '" data-condition-id="' + condition.id + '">' +
                    '<input type="checkbox" class="mr-3"' + (disabled ? ' disabled' : '') + '>' +
                    '<div class="flex-1">' +
                        '<span class="font-medium">' + condition.name + '</span>' +
                        '<p class="text-sm text-gray-500">' + condition.desc + '</p>' +
                    '</div>' +
                    '<span class="text-xs px-2 py-1 rounded-full ' + phaseClass + '">P' + condition.phase + '</span>' +
                    phaseIndicator +
                '</label>';
            }).join('');

            // 조건 체크박스 이벤트
            container.querySelectorAll('input[type="checkbox"]').forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    const conditionId = this.closest('label').getAttribute('data-condition-id');
                    const condition = conditionBlocks.find(function(c) { return c.id === conditionId; });
                    
                    if (this.checked) {
                        selectedConditions.push(condition);
                    } else {
                        selectedConditions = selectedConditions.filter(function(c) { return c.id !== conditionId; });
                    }
                    
                    updateAPIPreview();
                    updateBenefitPreview();
                });
            });
        }

        // API 미리보기 업데이트
        function updateAPIPreview() {
            const apiContent = document.getElementById('api-preview-content');
            if (selectedLogic) {
                const apiData = {
                    type: selectedLogic.id,
                    name: selectedLogic.name,
                    phase: selectedLogic.phase,
                    conditions: selectedConditions.map(function(c) { return {id: c.id, phase: c.phase}; })
                };
                apiContent.textContent = JSON.stringify(apiData, null, 2);
            }
        }

        // 혜택 미리보기 업데이트
        function updateBenefitPreview() {
            const preview = document.getElementById('benefit-preview');
            if (selectedLogic) {
                const conditionsText = selectedConditions.map(function(c) { return c.desc; }).join(' + ');
                const fullText = conditionsText ? conditionsText + ' → ' + selectedLogic.desc : selectedLogic.desc;
                
                preview.innerHTML = '<div class="text-center">' +
                    '<div class="font-semibold text-gray-900 mb-2">' + fullText + '</div>' +
                    '<div class="text-sm text-gray-500">Phase ' + selectedLogic.phase + ' 로직 조합</div>' +
                '</div>';
            }
        }

        // 차트 초기화 - 완전히 새로운 방식
        function initCharts() {
            try {
                // Chart.js가 로드되었는지 확인
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js가 로드되지 않았습니다.');
                    return;
                }

                // 성과 차트
                const performanceCanvas = document.getElementById('performanceChart');
                if (performanceCanvas) {
                    // 기존 차트가 있다면 제거
                    if (window.performanceChartInstance) {
                        window.performanceChartInstance.destroy();
                    }

                    const ctx = performanceCanvas.getContext('2d');
                    window.performanceChartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['1월', '2월', '3월', '4월', '5월'],
                            datasets: [{
                                label: '발급',
                                data: [45000, 52000, 48000, 58000, 62000],
                                borderColor: '#4CAF50',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                borderWidth: 2,
                                fill: false
                            }, {
                                label: '사용',
                                data: [38000, 44000, 42000, 51000, 56000],
                                borderColor: '#2196F3',
                                backgroundColor: 'rgba(33, 150, 243, 0.1)',
                                borderWidth: 2,
                                fill: false
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                    console.log('성과 차트 생성 완료');
                }

                // 분포 차트
                const distributionCanvas = document.getElementById('distributionChart');
                if (distributionCanvas) {
                    // 기존 차트가 있다면 제거
                    if (window.distributionChartInstance) {
                        window.distributionChartInstance.destroy();
                    }

                    const ctx = distributionCanvas.getContext('2d');
                    window.distributionChartInstance = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['결제', '카드', '증권', '멤버십'],
                            datasets: [{
                                data: [45, 25, 20, 10],
                                backgroundColor: ['#4CAF50', '#FF9800', '#2196F3', '#9C27B0'],
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                    console.log('분포 차트 생성 완료');
                }

            } catch (error) {
                console.error('차트 초기화 오류:', error);
            }
        }

        // ROI 차트 초기화
        function initROIChart() {
            try {
                const roiCanvas = document.getElementById('roiChart');
                if (roiCanvas) {
                    // 기존 차트가 있다면 제거
                    if (window.roiChartInstance) {
                        window.roiChartInstance.destroy();
                    }

                    const ctx = roiCanvas.getContext('2d');
                    window.roiChartInstance = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['결제', '카드', '증권', '멤버십'],
                            datasets: [{
                                label: 'ROI (%)',
                                data: [320, 280, 450, 180],
                                backgroundColor: '#F59E0B',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                    console.log('ROI 차트 생성 완료');
                }
            } catch (error) {
                console.error('ROI 차트 초기화 오류:', error);
            }
        }

        // 페이지 로드 후 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('페이지 로드 완료');
            
            // Chart.js 로드 확인
            if (typeof Chart !== 'undefined') {
                console.log('Chart.js 로드 완료');
                // 즉시 차트 초기화 (대시보드가 기본으로 표시되므로)
                setTimeout(function() {
                    initCharts();
                }, 100);
            } else {
                console.error('Chart.js가 로드되지 않았습니다.');
            }

            // 탭 버튼 이벤트
            document.querySelectorAll('.tab-button').forEach(function(button) {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            // 새 혜택 버튼 이벤트
            document.querySelector('.create-benefit-btn').addEventListener('click', function() {
                switchTab('create');
            });

            // 확장 관리 토글 이벤트
            document.getElementById('extension-toggle').addEventListener('click', function() {
                const panel = document.getElementById('extension-panel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            });

            // 혜택 생성 버튼 이벤트
            document.getElementById('create-benefit-final').addEventListener('click', function() {
                if (selectedLogic) {
                    alert('혜택이 성공적으로 생성되었습니다!');
                }
            });
        });
    </script>
</body>
</html>
